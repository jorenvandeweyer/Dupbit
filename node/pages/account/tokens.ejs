<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include ../components/head %>
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    </head>
    <body>
        <%- include ../components/header %>
        <br>

        <div class="container">
			<div class="card">
				<div class="card-header"><b>Manage Tokens</b></div>
				<div class="card-body">
					<table class='table table-hover'>
						<thead>
                            <tr>
                                <th>ID</th>
                                <th>Info</th>
                                <th>Device</th>
                                <th>IP</th>
                                <th>Created</th>
                                <th>Delete</th>
                            </tr>
						</thead>
						<tbody>
                            <tr v-for="token in tokens">
                                <td>{{token.tid}}</td>
                                <td>{{token.app_type}}</td>
                                <td>{{token.info}}</td>
                                <td>{{token.ip}}</td>
                                <td>{{token.timestamp}}</td>
                                <td><button type='button' class='btn btn-danger' @click='deleteToken(token.id)'>Revoke</button></td>
                            </tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

        <%- include ../components/footer %>
    </body>

    <script>
    async function main() {
        const result = await Request.GET("/api/connect/devices");
        if (result && result.success) {
            vm.tokens = result.tokens;
        }
    }

    const vm = new Vue({
        container: ".container",
        data: {
            tokens: [],
        },
        methods: {
            deleteToken: async function (tid) {
                const result = Request.GET(`/api/account/removeToken?tid=${tid}`);
                if (result && result.success) {
                    this.tokens = this.tokens.filter(token => token.tid !== tid);
                } else {
                    alert(`Please take contact with the website owner and provide the error string\nError: removeToken?tid=${tid} success=false`);
                }
            }
        }
    });

    main();
    </script>

</html>
