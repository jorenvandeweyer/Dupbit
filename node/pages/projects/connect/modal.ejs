<!DOCTYPE html>
<html lang="en">

	<head>
		<%- include /usr/src/app/pages/components/head %>
        <style>
            .slider {
                -webkit-appearance: none;
                width: 70%;
                height: 15px;
                margin: 5px;
                border-radius: 5px;
                background: #d3d3d3;
                outline: none;
                opacity: 0.7;
                -webkit-transition: .2s;
                transition: opacity .2s;
            }
            .slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                background: #4CAF50;
                cursor: pointer;
            }
            .slider::-moz-range-thumb {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                background: #4CAF50;
                cursor: pointer;
            }
            .volume-buttons {
                margin: 5px;
                width: 80px;
                height: 25px;
                display: flex !important;
                align-items: center;
                justify-content: center;
            }
            .volume-up-helper {
                 position: absolute;
                 left: 10px;
            }
            .slidecontainer {
                position: relative
            }
            .action-buttons {
                margin: 1px;
            }
       </style>
	</head>

	<body>
		<%- include /usr/src/app/pages/components/header %>
        </br>
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h3> Hold on. </h3>
                </div>
                <div class="card-body">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#device_modal">
                        Open Modal
                    </button>
                </div>

                <div class="modal fade" id="device_modal" tabindex="-1" role="dialog" aria-labelledby="device_modal_label" aria-hidden="true">
                    <div class="modal-dialog modal-sm" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="device_modal_label">Modal title</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="slidecontainer d-flex justify-content-center">
                                    <i class="fas fa-volume-up volume-up-helper" style="margin:5px"> </i> <input type="range" min="0" max="20" value="10" class="slider" id="slider">
                                </div>

                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-primary btn-sm volume-buttons" onclick="modal.toggleMute()">
                                        <i class="fas fa-volume-off"></i>
                                    </button>
                                    <button id="volume-down" type="button" class="btn btn-primary btn-sm volume-buttons" ontouchstart="slider.changeVolume(false)" onmousedown="slider.changeVolume(false)">
                                        <i class="fas fa-volume-down"></i>
                                    </button>
                                    <button id="volume-up"type="button" class="btn btn-primary btn-sm volume-buttons" ontouchstart="slider.changeVolume(true)" onmousedown="slider.changeVolume(true)">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                </div>

                                <hr/>
                                <div><button type="button" class="btn btn-outline-dark action-buttons"><i class="fas fa-desktop text-primary"></i> Turn Off Screen</button></div>
                                <div><button type="button" class="btn btn-outline-dark action-buttons"><i class="fas fa-lock text-primary"></i> Lock Device</a></button></div>
                                <div><button type="button" class="btn btn-outline-dark action-buttons"><i class="fas fa-lock-open text-primary"></i> Unlock Device</a></button></div>
                                <hr/>
                                <div><button type="button" class="btn btn-outline-dark"><i class="fas fa-power-off text-primary"></i> Power Off Machine</button></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            const slider = {
                delay: 300,
                initialDelay: 300,
                multiplier: 0.2,
                timerIsRunning: false,
                el: document.getElementById("slider"),
                holdtimer: null,
                changeVolume: function(up) {
                    if (this.el.disabled) return;

                    if (up && this.el.value < 20) {
                        this.el.value++;
                    } else if (!up && this.el.value > 0) {
                        this.el.value--;
                    }

                    this.holdTimer = setTimeout(() => { this.changeVolume(up) }, this.delay);

                    this.delay = this.delay * this.multiplier;
                    if (this.delay < 35) this.delay = 35;

                    if (!this.timerIsRunning) {
                        document.onmouseup = () => {
                            slider.clear();
                        }

                        document.ontouchend = () => {
                            slider.clear();
                        }
                        this.timerIsRunning = true;
                    }
                },
                clear: function() {
                    clearTimeout(this.holdTimer);
                    document.onmouseup = null;
                    document.ontouchend = null;
                    this.timerIsRunning = false;
                    this.delay = this.initialDelay + 0;
                }

            }

            const modal = {
                mute: false,
                setTitle: (title) => {
                    document.getElementById("device_modal_label").innerText = title;
                },
                toggleMute: () => {
                    this.mute = !this.mute;
                    const volumeup = document.getElementById("volume-up").disabled = mute;
                    const volumedown = document.getElementById("volume-down").disabled = mute;
                    slider.el.disabled = mute;
                },
            }

            function main() {
                modal.setTitle("Device 1");
                slider.el.oninput = function() {
                    console.log(this.value*5);
                }
            }

            main();

            document.addEventListener('touchmove', function(event) {
                event = event.originalEvent || event;
                if (event.scale !== 1) {
                   event.preventDefault();
                }
            }, false);
        </script>
        <%- include /usr/src/app/pages/components/footer %>
	</body>
</html>
