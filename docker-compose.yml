version: "3.7"
services:
    nginx:
        build: ./nginx
        volumes:
            - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
            - ./.logs/:/etc/logs/
            - ./.certs/:/etc/certs/
        restart: always
        ports:
            - "80:80"
            - "443:443"
        networks:
            - dupbit-network
    api:
        build: ./api
        env_file:
            - ./.env
        volumes:
            - ./api/src/:/usr/src/app/src/
            - ./.certs/:/etc/certs/
        restart: always
        depends_on:
            - database
        networks:
            - dupbit-network
    # web:
    #     build: ./node
    #     env_file:
    #         - ./node/.env
    #     volumes:
    #         - ./node/config.json:/usr/src/app/config.json
    #         - ./node/pages/:/usr/src/app/pages/
    #         - ./node/api/:/usr/src/app/api/
    #         - ./node/src/:/usr/src/app/src/
    #         - ./node/scripts/:/usr/src/app/scripts/
    #         - ./files/youtube-dl/:/usr/src/app/data/music/
    #         - ./node/data/secrets/:/usr/src/app/data/secrets/
    #     depends_on:
    #         - database
    #     restart: always
    #     networks:
    #         - prime
    # youtube-dl:
    #     build: ./youtube-dl
    #     volumes:
    #       - ./files/youtube-dl/:/usr/src/app/files/
    #     networks:
    #       - prime
    database:
        image: mariadb:latest
        env_file:
            - ./.env
        ports:
            - "3306:3306"
        volumes:
            - ./.database/:/var/lib/mysql
        restart: always
        networks:
            - dupbit-network
networks:
    dupbit-network:
        name: dupbit-network
        driver: bridge
